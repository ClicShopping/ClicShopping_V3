!function(e,t){if("function"==typeof define&&define.amd)define(["elfinder"],e);else if(t){var n=t.prototype._options.commandsOptions.edit.editors;t.prototype._options.commandsOptions.edit.editors=n.concat(e(t))}}(function(e){"use strict";var t=window.location.search.match(/getfile=([a-z]+)/),n=e.prototype.hasRequire,o=function(){var e;try{e=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){e=!!("undefined"==typeof window.orientation||navigator&&navigator.mimeTypes["application/x-shockwave-flash"])}return e}(),i={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/x-ms-bmp",svg:"image/svg+xml",pxd:"image/x-pixlr-data"},a=function(e,t,n,o){var i=function(){var e=o.mimeTypes[t.mime];return"jpeg"===e&&(e="jpg"),e},a=$(this).children("img:first").data("ext",i(t)),r=$("<div/>").css({position:"absolute",top:"50%",textAlign:"center",width:"100%",fontSize:"16pt"}).html(o.i18n("ntfloadimg")).hide().appendTo(this);a.attr("id",e+"-img").attr("src",n).css({height:"","max-width":"100%","max-height":"100%",cursor:"pointer"}).data("loading",function(e){var t=a.closest(".elfinder-dialog").find("button,.elfinder-titlebar-button");return t.prop("disabled",!e)[e?"removeClass":"addClass"]("ui-state-disabled"),a.css("opacity",e?"":"0.3"),r[e?"hide":"show"](),a})},r=function(e,t){var n,o,i,a=e.attr("style");try{e.attr("style",""),n=e.get(0),o=document.createElement("canvas"),o.width=n.width,o.height=n.height,e.attr("style",a),o.getContext("2d").drawImage(n,0,0),i=o.toDataURL(t)}catch(r){i=e.attr("src")}return i},c=function(){if(o&&window.parent!==window){var e,t,n,a,r,c=window.location.search.match(/[?&]pixlr=([^&]+)/),d=window.location.search.match(/[?&]image=([^&]+)/);c&&(e=window.parent,t=e.$("#"+c[1]+"iframe").hide(),a=e.$("#"+c[1]).data("resizeoff")(),"http"===d[1].substr(0,4)?(n=d[1],r=n.replace(/.+\.([^.]+)$/,"$1"),a.data("ext")!==r&&a.closest(".ui-dialog").trigger("changeType",{extention:r,mime:i[r]}),"https:"===window.location.protocol&&(n=n.replace(/^http:/,"https:")),a.on("load error",function(){a.data("loading")(!0)}).attr("src",n).data("loading")()):a.data("loading")(!0),t.trigger("destroy").remove())}},d=function(e,t){o&&!t.UA.ltIE8||(this.disabled=!0)},s=function(e,t){var n,o=this,i=this.fm,a=i.res("class","preventback"),r=$(t).children("img:first").data("loading")().data("resizeoff",function(){return $(window).off("resize."+r.attr("id")),c.addClass(a),r}).on("click",function(){m()}),c=$(t).closest(".ui-dialog"),d=i.getUI(),s=$('<iframe class="ui-front" allowtransparency="true">'),l=this.file,p=15,f=function(e){e?(s.trigger("destroy").remove(),r.data("loading")(!0),i.error(e)):(i.toast({mode:"info",msg:"Can not launch Pixlr yet. Waiting "+p+" seconds.",extNode:$('<button class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"/>').append($('<span class="ui-button-text"/>').text(i.i18n("Abort"))).on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){s.trigger("destroy").remove(),r.data("loading")(!0)})}),n=setTimeout(e,1e3*p))},m=function(){var m="https://pixlr.com/"+e+"/?s=c",u=window.location.href.toString().replace(/#.*$/,""),h={};n=setTimeout(f,1e3*p),u+=(u.indexOf("?")===-1?"?":"&")+"pixlr="+r.attr("id"),m+="&referrer=elFinder&locktitle=true",m+="&exit="+encodeURIComponent(u+"&image=0"),m+="&target="+encodeURIComponent(u),m+="&title="+encodeURIComponent(l.name),m+="&image="+encodeURIComponent(r.attr("src")),h.src=m,h.css={width:"100%",height:$(window).height()+"px",position:"fixed",display:"block",backgroundColor:"transparent",border:"none",top:0,right:0},o.trigger("Prepare",{node:t,editorObj:void 0,instance:s,opts:h}),s.attr("id",r.attr("id")+"iframe").attr("src",h.src).css(h.css).on("load",function(){n&&clearTimeout(n),setTimeout(function(){s.is(":hidden")&&f("Please disable your ad blocker.")},1e3),c.addClass(a),i.toggleMaximize(s,!0),i.toFront(s)}).on("destroy",function(){i.toggleMaximize(s,!1)}).on("error",f).appendTo(d.hasClass("elfinder-fullscreen")?d:"body")};$(t).on("saveAsFail",m),m()};return c(),t&&(t=t[1],"ckeditor"===t?e.prototype._options.getFileCallback=function(e,t){window.opener.CKEDITOR.tools.callFunction(function(){var e=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),t=window.location.search.match(e);return t&&t.length>1?t[1]:""}(),t.convAbsUrl(e.url)),t.destroy(),window.close()}:"tinymce"===t&&(e.prototype._options.getFileCallback=function(e,t){parent.tinymce.activeEditor.windowManager.getParams().oninsert(e,t),parent.tinymce.activeEditor.windowManager.close()})),[{info:{id:"pixlreditor",name:"Pixlr Editor",iconImg:"img/edit_pixlreditor.png",urlAsContent:!0,schemeContent:!0,single:!0,integrate:{title:"PIXLR EDITOR",link:"https://pixlr.com/editor/"}},mimes:["image/jpeg","image/png","image/gif","image/x-ms-bmp","image/x-pixlr-data"],html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',setup:function(e,t){d.call(this,e,t)},init:function(e,t,n,o){a.call(this,e,t,o.convAbsUrl(n),o)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){s.call(this,"editor",e)},save:function(e){},close:function(e){}},{info:{id:"pixlrexpress",name:"Pixlr Express",iconImg:"img/edit_pixlrexpress.png",urlAsContent:!0,schemeContent:!0,single:!0,integrate:{title:"PIXLR EXPRESS",link:"https://pixlr.com/express/"}},mimes:["image/jpeg","image/png","image/gif"],html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',setup:function(e,t){d.call(this,e,t)},init:function(e,t,n,o){a.call(this,e,t,o.convAbsUrl(n),o)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){s.call(this,"express",e)},save:function(e){},close:function(e){}},{info:{id:"creativecloud",name:"Creative Cloud",iconImg:"img/edit_creativecloud.png",schemeContent:!0,single:!0,integrate:{title:"Adobe Creative Cloud",link:"https://www.adobe.io/apis/creativecloud.html"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',setup:function(e,t){!t.UA.ltIE8&&e.extraOptions&&e.extraOptions.creativeCloudApiKey?this.apiKey=e.extraOptions.creativeCloudApiKey:this.disabled=!0},init:function(e,t,n,o){a.call(this,e,t,n,o)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){var t,n=this,o=this.fm,a=$(e).children("img:first"),r=$(e).closest(".ui-dialog"),c=o.getUI(),d=$.Deferred(),s=$("#elfinder-aviary-container"),l=function(l){var f,m=function(){var e={zh_TW:"zh_HANT",zh_CN:"zh_HANS"};return e[o.lang]?e[o.lang]:o.lang};s.length?s.appendTo(s.parent()):(s=$('<div id="elfinder-aviary-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"auto"}).hide().appendTo(c.hasClass("elfinder-fullscreen")?c:"body"),c.on("resize."+o.namespace,function(e,t){e.preventDefault(),e.stopPropagation(),t&&t.fullscreen&&s.appendTo("on"===t.fullscreen?c:"body")}),o.bind("destroy",function(){s.remove()})),a.on("click",p).data("loading")(),f={apiKey:n.confObj.apiKey,onSave:function(e,n){var o;t.showWaitIndicator(),o=n.replace(/.+\.([^.]+)$/,"$1"),a.data("ext")!==o&&a.closest(".ui-dialog").trigger("changeType",{extention:o,mime:i[o]}),a.on("load error",function(){a.data("loading")(!0)}).attr("crossorigin","anonymous").attr("src",n).data("loading")(),t.close()},onLoad:l||function(){},onClose:function(){r.removeClass(o.res("class","preventback")),o.toggleMaximize(s,!1),$(s).hide()},appendTo:s.get(0),maxSize:2048,language:m()},n.trigger("Prepare",{node:e,editorObj:Aviary,instance:void 0,opts:f}),t=new Aviary.Feather(f),d.resolve(t),$(e).on("saveAsFail",p)},p=function(){r.addClass(o.res("class","preventback")),o.toggleMaximize(s,!0),o.toFront(s),$(s).show(),t.launch({image:a.attr("id"),url:a.attr("src")}),a.data("loading")(!0)};return"undefined"==typeof Aviary?o.loadScript(["https://dme0ih8comzn4.cloudfront.net/imaging/v3/editor.js"],function(){l(p)},{loadType:"tag"}):(l(),p()),d},save:function(e){var t=$(e).children("img:first");"data:"!==t.attr("src").substr(0,5)&&t.attr("src",r(t,this.file.mime))}},{setup:function(e,t){!t.UA.ltIE8&&t.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"ACE Editor",iconImg:"img/edit_aceeditor.png"},load:function(e){var t=this,n=this.fm,o=$.Deferred(),i=n.options.cdns.ace,a=function(){var n,a,r,c=$(e),d=c.parent(),s=d.parent(),l=e.id+"_ace",p=(t.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),{"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"});d.height(d.height()),ace.config.set("basePath",i),a=$('<div id="'+l+'" style="width:100%; height:100%;"/>').text(c.val()).insertBefore(c.hide()),c.data("ace",!0),n=ace.edit(l),n.$blockScrolling=1/0,n.setOptions({theme:"ace/theme/monokai",fontSize:"14px",wrap:!0}),ace.config.loadModule("ace/ext/modelist",function(){r=ace.require("ace/ext/modelist").getModeForPath("/"+t.file.name).name,"text"===r&&p[t.file.mime]&&(r=p[t.file.mime]),d.prev().children(".elfinder-dialog-title").append(" ("+t.file.mime+" : "+r.split(/[\/\\]/).pop()+")"),n.setOptions({mode:"ace/mode/"+r}),"resolved"===o.state()&&s.trigger("resize")}),ace.config.loadModule("ace/ext/language_tools",function(){ace.require("ace/ext/language_tools"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),ace.config.loadModule("ace/ext/settings_menu",function(){ace.require("ace/ext/settings_menu").init(n)}),n.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(e){t.doSave()}}),n.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(e){t.doCancel()}}),n.resize(),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(t.fm.i18n("TextArea")).button().on("click",function(){c.data("ace")?(c.removeData("ace"),a.hide(),c.val(n.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(c.data("ace",!0),a.show(),n.setValue(c.hide().val(),-1),n.focus(),$(this).html(t.fm.i18n("TextArea")))})).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){n.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().parent().appendTo($("#elfinder"))})).prependTo(d.next()),t.trigger("Prepare",{node:e,editorObj:ace,instance:n,opts:{}}),s.trigger("resize"),o.resolve(n)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadScript([i+"/ace.js"],function(){t.confObj.loader.resolve()},void 0,{obj:window,name:"ace"})),t.confObj.loader.done(a),o},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&$(e).data("ace")&&(e.value=t.session.getValue())},focus:function(e,t){t&&$(e).data("ace")&&t.focus()},resize:function(e,t,n,o){t&&t.resize()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.codemirror||(this.disabled=!0)},info:{id:"codemirror",name:"CodeMirror",iconImg:"img/edit_codemirror.png"},load:function(e){var t=this.fm,o=t.options.cdns.codemirror,i=$.Deferred(),a=this,r=function(t){var r,c,d,s=$(e),l=s.parent();l.height(l.height()),d={lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-S":function(){a.doSave()},"Ctrl-Q":function(){a.doCancel()},"Ctrl-W":function(){a.doCancel()}}},a.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:d}),r=t.fromTextArea(e,d),i.resolve(r);var p,f,m,u;p||(p=t.findModeByMIME(a.file.mime)),!p&&(f=a.file.name.match(/.+\.([^.]+)$/))&&(p=t.findModeByExtension(f[1])),p&&(t.modeURL=n?"codemirror/mode/%N/%N.min":o+"/mode/%N/%N.min.js",m=p.mode,u=p.mime,r.setOption("mode",u),t.autoLoadMode(r,m),l.prev().children(".elfinder-dialog-title").append(" ("+u+" : "+m+")")),c=$(r.getWrapperElement()).css({padding:0,border:"none"}),s.data("cm",!0),c.height("100%"),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(a.fm.i18n("TextArea")).button().on("click",function(){s.data("cm")?(s.removeData("cm"),c.hide(),s.val(r.getValue()).show().trigger("focus"),$(this).text("CodeMirror")):(s.data("cm",!0),c.show(),r.setValue(s.hide().val()),r.refresh(),r.focus(),$(this).html(a.fm.i18n("TextArea")))})).prependTo(l.next()),l.parent().trigger("resize")};return a.confObj.loader||(a.confObj.loader=$.Deferred(),n?(require.config({packages:[{name:"codemirror",location:o,main:"codemirror.min"}],map:{codemirror:{"codemirror/lib/codemirror":"codemirror"}}}),require(["codemirror","codemirror/addon/mode/loadmode.min","codemirror/mode/meta.min"],function(e){a.confObj.loader.resolve(e)})):a.fm.loadScript([o+"/codemirror.min.js"],function(){a.fm.loadScript([o+"/addon/mode/loadmode.min.js",o+"/mode/meta.min.js"],function(){a.confObj.loader.resolve(CodeMirror)})},{loadType:"tag"}),a.fm.loadCss(o+"/codemirror.css")),a.confObj.loader.done(r),i},close:function(e,t){t&&t.toTextArea()},save:function(e,t){t&&$(e).data("cm")&&(e.value=t.getValue())},focus:function(e,t){t&&$(e).data("cm")&&t.focus()},resize:function(e,t,n,o){t&&t.refresh()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.simplemde||(this.disabled=!0)},info:{id:"simplemde",name:"SimpleMDE",iconImg:"img/edit_simplemde.png"},exts:["md"],load:function(e){var t=this,o=this.fm,i=$(e).parent(),a=$.Deferred(),r=o.options.cdns.simplemde,c=function(n){var o,r,c,d=i.height(),s=i.outerHeight(!0)-d+14;e._setHeight=function(e){var t,n=e||i.height(),a=0;return i.children(".editor-toolbar,.editor-statusbar").each(function(){a+=$(this).outerHeight(!0)}),t=n-a-s,r.height(t),o.codemirror.refresh(),t},i.height(d),c={element:e,autofocus:!0},t.trigger("Prepare",{node:e,editorObj:n,instance:void 0,opts:c}),o=new n(c),a.resolve(o),r=$(o.codemirror.getWrapperElement()),r.css("min-height","50px").children(".CodeMirror-scroll").css("min-height","50px"),e._setHeight(d)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadCss(r+"/simplemde.min.css"),n?require([r+"/simplemde.min.js"],function(e){t.confObj.loader.resolve(e)}):t.fm.loadScript([r+"/simplemde.min.js"],function(){t.confObj.loader.resolve(SimpleMDE)},{loadType:"tag"})),t.confObj.loader.done(c),a},close:function(e,t){t&&t.toTextArea(),t=null},save:function(e,t){t&&(e.value=t.value())},focus:function(e,t){t&&t.codemirror.focus()},resize:function(e,t,n,o){t&&e._setHeight()}},{info:{id:"ckeditor",name:"CKEditor",iconImg:"img/edit_ckeditor.png"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.ckeditor?e.extraOptions&&e.extraOptions.managerUrl&&(this.managerUrl=e.extraOptions.managerUrl):this.disabled=!0},load:function(e){var t=this,n=this.fm,o=$.Deferred(),i=function(){var i,a=$(e).parent(),r=a.closest(".elfinder-dialog"),c=a.height(),d=/([&?]getfile=)[^&]+/,s=t.confObj.managerUrl||window.location.href.replace(/#.*$/,""),l="ckeditor";d.test(s)?s=s.replace(d,"$1"+l):s+="?getfile="+l,a.height(c),i={startupFocus:!0,fullPage:!0,allowedContent:!0,filebrowserBrowseUrl:s,toolbarCanCollapse:!0,toolbarStartupExpanded:!n.UA.Mobile,removePlugins:"resize",extraPlugins:"colorbutton,justify,docprops",on:{instanceReady:function(i){var a=i.editor;a.resize("100%",c),r.one("beforedommove."+n.namespace,function(){a.destroy()}).one("dommove."+n.namespace,function(){t.load(e).done(function(e){t.instance=e})}),o.resolve(i.editor)}}},t.trigger("Prepare",{node:e,editorObj:CKEDITOR,instance:void 0,opts:i}),CKEDITOR.replace(e.id,i),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.definition.dialog;t.on("show",function(e){n.getUI().append($(".cke_dialog_background_cover")).append(this.getElement().$)}),t.on("hide",function(e){$("body:first").append($(".cke_dialog_background_cover")).append(this.getElement().$)})})};return t.confObj.loader||(t.confObj.loader=$.Deferred(),window.CKEDITOR_BASEPATH=n.options.cdns.ckeditor+"/",$.getScript(n.options.cdns.ckeditor+"/ckeditor.js",function(){t.confObj.loader.resolve()})),t.confObj.loader.done(i),o},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&(e.value=t.getData())},focus:function(e,t){t&&t.focus()},resize:function(e,t,n,o){t&&"ready"===t.status&&t.resize("100%",$(e).parent().height())}},{info:{id:"ckeditor5",name:"CKEditor5",iconImg:"img/edit_ckeditor5.png"},exts:["htm","html","xhtml"],html:'<div class="edit-editor-ckeditor5"></div>',setup:function(e,t){var n=this;t.options.cdns.ckeditor5&&"function"==typeof window.Symbol&&"symbol"==typeof Symbol()?e.extraOptions&&e.extraOptions.ckeditor5Mode&&(this.ckeditor5Mode=e.extraOptions.ckeditor5Mode):this.disabled=!0,t.bind("destroy",function(){n.editor=null})},prepare:function(e,t,n){$(e).height(e.editor.fm.getUI().height()-100)},init:function(e,t,n,o){var i=n.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),a="",r="",c="";this.css({width:"100%",height:"100%","box-sizing":"border-box"}),i?(a=i[1],r=i[2],c=i[3]):r=n,this.data("data",{header:a,body:r,footer:c})},load:function(e){var t,n=this,o=this.fm,i=$.Deferred(),a=n.confObj.ckeditor5Mode||"balloon",r=function(){var e=o.lang.toLowerCase().replace("_","-");return"zh"===e.substr(0,2)&&"zh-cn"!==e&&(e="zh"),e}(),c=function(t){var a,c=$(e).parent();c.height(o.getUI().height()-100),a={toolbar:["heading","|","bold","italic","link","imageUpload","bulletedList","numberedList","blockQuote","undo","redo"],language:r},n.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:a}),t.create(e,a).then(function(t){var n=t.plugins.get("FileRepository");n.createUploadAdapter=function(e){return new d(e)},t.setData($(e).data("data").body),o.getUI().append($("body > div.ck-body")),$("div.ck-balloon-panel").css({"z-index":o.getMaximizeCss().zIndex+1}),i.resolve(t)})["catch"](function(e){o.error(e)})},d=function(e){this.upload=function(){return new Promise(function(t,n){o.exec("upload",{files:[e.file]},void 0,o.cwd().hash).done(function(e){e.added&&e.added.length?o.url(e.added[0].hash,{async:!0}).done(function(e){t({"default":o.convAbsUrl(e)})}).fail(function(){n("errFileNotFound")}):n(o.i18n(e.error?e.error:"errUpload"))}).fail(function(e){n(o.i18n(e?"userabort"===e?"errAbort":e:"errUploadNoFiles"))}).progress(function(t){e.uploadTotal=t.total,e.uploaded=t.progress})})},this.abort=function(){o.getUI().trigger("uploadabort")}};return n.confObj.editor?c(n.confObj.editor):(t=$.Deferred(),n.fm.loadScript([o.options.cdns.ckeditor5+"/"+a+"/ckeditor.js"],function(e){e||(e=window.BalloonEditor||window.InlineEditor||window.ClassicEditor),"en"!==o.lang?n.fm.loadScript([o.options.cdns.ckeditor5+"/"+a+"/translations/"+r+".js"],function(n){t.resolve(e)},{tryRequire:!0,loadType:"tag",error:function(n){r="en",t.resolve(e)}}):t.resolve(e)},{tryRequire:!0,loadType:"tag"}),t.done(function(e){n.confObj.editor=e,c(e)})),i},getContent:function(){var e=$(this).data("data");return e.header+e.body+e.footer},close:function(e,t){t&&t.destroy()},save:function(e,t){var n=$(e),o=n.data("data");t&&(o.body=t.getData(),n.data("data",o))},focus:function(e,t){$(e).trigger("focus")}},{info:{id:"tinymce",name:"TinyMCE",iconImg:"img/edit_tinymce.png"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.tinymce?e.extraOptions&&e.extraOptions.managerUrl&&(this.managerUrl=e.extraOptions.managerUrl):this.disabled=!0},load:function(e){var t=this,n=this.fm,o=$.Deferred(),i=function(){var i,a=$(e).parent(),r=a.closest(".elfinder-dialog"),c=a.height(),d=a.outerHeight(!0)-c;a.height(c),e._setHeight=function(e){var t,n=$(this).parent(),o=e||n.height(),i=0;return n.find(".mce-container-body:first").children(".mce-top-part,.mce-statusbar").each(function(){i+=$(this).outerHeight(!0)}),t=o-i-d,n.find(".mce-edit-area iframe:first").height(t),t},i={selector:"#"+e.id,resize:!1,plugins:["fullpage","image","link","media","code","fullscreen"],init_instance_callback:function(i){e._setHeight(c),r.one("beforedommove."+n.namespace,function(){tinymce.execCommand("mceRemoveEditor",!1,e.id)}).one("dommove."+n.namespace,function(){t.load(e).done(function(e){t.instance=e})}),o.resolve(i)},file_picker_callback:function(e,n,o){var i=/([&?]getfile=)[^&]+/,a=t.confObj.managerUrl||window.location.href.replace(/#.*$/,""),r="tinymce";return i.test(a)?a=a.replace(i,"$1"+r):a+="?getfile="+r,tinymce.activeEditor.windowManager.open({file:a,title:"elFinder",width:900,height:450,resizable:"yes"},{oninsert:function(t,n){var i,a;i=n.convAbsUrl(t.url),a=t.name+" ("+n.formatSize(t.size)+")","file"==o.filetype&&e(i,{text:a,title:a}),"image"==o.filetype&&e(i,{alt:a}),"media"==o.filetype&&e(i)}}),!1}},t.trigger("Prepare",{node:e,editorObj:tinymce,instance:void 0,opts:i}),tinymce.init(i)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),$.getScript(n.options.cdns.tinymce+"/tinymce.min.js",function(){setTimeout(function(){t.confObj.loader.resolve()},0)})),t.confObj.loader.done(i),o},close:function(e,t){t&&tinymce.execCommand("mceRemoveEditor",!1,e.id)},save:function(e,t){t&&t.save()},focus:function(e,t){t&&t.focus()},resize:function(e,t,n,o){t&&e._setHeight()}},{info:{id:"zohoeditor",name:"Zoho Editor",iconImg:"img/edit_zohooffice.png",cmdCheck:"ZohoOffice",preventGet:!0,hideButtons:!0,syncInterval:15e3,integrate:{title:"Zoho Office API",link:"https://www.zoho.com/officeapi/"}},mimes:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/rtf","text/html","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","application/vnd.sun.xml.calc","text/csv","text/tab-separated-values","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.oasis.opendocument.presentation","application/vnd.sun.xml.impress"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.Mobile||t.UA.ltIE8)&&(this.disabled=!0)},prepare:function(e,t,n){var o=e.editor.fm.getUI();$(e).height(o.height()),t.width=Math.max(t.width||0,.8*o.width())},init:function(e,t,n,o){var i=this,a=$(this).hide(),r=$("<div/>").css({position:"absolute",top:"50%",textAlign:"center",width:"100%",fontSize:"16pt"}).html(o.i18n("nowLoading")+'<span class="elfinder-spinner"/>').appendTo(a.parent()),c=function(){var e="";return $.each(o.customData,function(t,n){e+="&"+encodeURIComponent(t)+"="+encodeURIComponent(n)}),e};$(i).data("xhr",o.request({data:{cmd:"editor",name:"ZohoOffice",method:"init","args[target]":t.hash,"args[lang]":o.lang,"args[cdata]":c},preventDefault:!0}).done(function(e){var t;e.zohourl?(t={css:{height:"100%"}},i.editor.trigger("Prepare",{node:i,editorObj:void 0,instance:a,opts:t}),a.attr("src",e.zohourl).show().css(t.css)):(e.error&&o.error(e.error),i.elfinderdialog("destroy"))}).fail(function(e){e&&o.error(e),i.elfinderdialog("destroy")}).always(function(){r.remove()}))},load:function(){},getContent:function(){},save:function(){},beforeclose:function(e){var t=$.Deferred(),n="about:blank";return e.src=n,setTimeout(function(){var o;try{o=e.contentWindow.location.href}catch(i){o=null}o===n?t.resolve():t.reject()},10),t},close:function(e){var t=(this.fm,$(e).data("xhr"));"pending"===t.state()&&t.reject()}},{info:{id:"ziparchive",name:"btnMount",cmdCheck:"ZipArchive",edit:function(e,t){var n=this,o=$.Deferred();return n.request({data:{cmd:"netmount",protocol:"ziparchive",host:e.hash,path:e.phash},notify:{type:"netmount",cnt:1,hideCnt:!0}}).done(function(e){var t;e.added&&e.added.length&&(e.added[0].phash&&(t=n.file(e.added[0].phash))&&(t.dirs||(t.dirs=1,n.change({changed:[t]}))),n.one("netmountdone",function(){n.exec("open",e.added[0].hash),n.one("opendone",function(){e.toast&&n.toast(e.toast)})})),o.resolve()}).fail(function(e){o.reject(e)}),o}},mimes:["application/zip"],load:function(){},save:function(){}},{info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}})},save:function(){}},{info:{id:"onlineconvert",name:"Online Convert",iconImg:"img/edit_onlineconvert.png",cmdCheck:"OnlineConvert",preventGet:!0,hideButtons:!0,single:!0,converter:!0,integrate:{title:"ONLINE-CONVERT.COM",link:"https://online-convert.com"}},mimes:["*"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(e,t){var n=e.extraOptions.onlineConvert||{maxSize:100,showLink:!0};n.maxSize&&(this.info.maxSize=1048576*n.maxSize),this.set=Object.assign({url:"https://%s.online-convert.com%s?external_url=",conv:{Archive:{"7Z":{},BZ2:{ext:"bz"},GZ:{},ZIP:{}},Audio:{MP3:{},OGG:{ext:"oga"},WAV:{},WMA:{},AAC:{},AIFF:{ext:"aif"},FLAC:{},M4A:{},MMF:{},OPUS:{ext:"oga"}},Document:{DOC:{},DOCX:{},HTML:{},ODT:{},PDF:{},PPT:{},PPTX:{},RTF:{},SWF:{},TXT:{}},eBook:{AZW3:{ext:"azw"},ePub:{},FB2:{ext:"xml"},LIT:{},LRF:{},MOBI:{},PDB:{},PDF:{},"PDF-eBook":{ext:"pdf"},TCR:{}},Hash:{Adler32:{},"Apache-htpasswd":{},Blowfish:{},CRC32:{},CRC32B:{},Gost:{},Haval128:{},MD4:{},MD5:{},RIPEMD128:{},RIPEMD160:{},SHA1:{},SHA256:{},SHA384:{},SHA512:{},Snefru:{},"Std-DES":{},Tiger128:{},"Tiger128-calculator":{},"Tiger128-converter":{},Tiger160:{},Tiger192:{},Whirlpool:{}},Image:{BMP:{},EPS:{ext:"ai"},GIF:{},EXR:{},ICO:{},JPG:{},PNG:{},SVG:{},TGA:{},TIFF:{ext:"tif"},WBMP:{},WebP:{}},Video:{"3G2":{},"3GP":{},AVI:{},FLV:{},HLS:{ext:"m3u8"},MKV:{},MOV:{},MP4:{},"MPEG-1":{ext:"mpeg"},"MPEG-2":{ext:"mpeg"},OGG:{ext:"ogv"},OGV:{},WebM:{},WMV:{},Android:{link:"/convert-video-for-%s",ext:"mp4"},Blackberry:{link:"/convert-video-for-%s",ext:"mp4"},DPG:{link:"/convert-video-for-%s",ext:"avi"},iPad:{link:"/convert-video-for-%s",ext:"mp4"},iPhone:{link:"/convert-video-for-%s",ext:"mp4"},iPod:{link:"/convert-video-for-%s",ext:"mp4"},"Nintendo-3DS":{link:"/convert-video-for-%s",ext:"avi"},"Nintendo-DS":{link:"/convert-video-for-%s",ext:"avi"},PS3:{link:"/convert-video-for-%s",ext:"mp4"},Wii:{link:"/convert-video-for-%s",ext:"avi"},Xbox:{link:"/convert-video-for-%s",ext:"wmv"}}},catExts:{Hash:"txt"},link:'<div class="elfinder-edit-onlineconvert-link"><a href="https://www.online-convert.com" target="_blank"><span class="elfinder-button-icon"></span>ONLINE-CONVERT.COM</a></div>',toastWidth:280,useTabs:$.fn.tabs},n)},prepare:function(e,t,n){var o=e.editor.fm.getUI();$(e).height(o.height()),t.width=Math.max(t.width||0,.8*o.width())},init:function(e,t,n,o){var i,a=this,r=a.editor.confObj,c=r.set,d={},s=o.uploadMimeCheck("application/zip",t.phash),l=function(e,t){var n;return c.catExts[e]?c.catExts[e]:c.conv[e]&&(n=c.conv[e][t])?(n.ext||t).toLowerCase():t.toLowerCase()},p=function(){var e=$("<div/>").on("click","button",function(){var e=$(this),t=e.data("opts")||null,n=e.closest(".onlineconvert-category").data("cname"),o=e.data("conv");r.api===!0?v({category:n,convert:o,options:t}):C(n,o)}).on("change",function(e){var t=$(e.target),n=t.parent(),i=t.closest(".elfinder-edit-onlineconvert-button").children("button:first"),a=i.data("opts")||{},r="boolean"===n.data("type")?t.is(":checked"):t.val();if(e.stopPropagation(),r&&("integer"===n.data("type")&&(r=parseInt(r)),n.data("pattern"))){var c=new RegExp(n.data("pattern"));c.test(r)||(requestAnimationFrame(function(){o.error('"'+o.escape(r)+'" is not match to "/'+o.escape(n.data("pattern"))+'/"')}),r=null)}r?a[t.parent().data("optkey")]=r:delete a[n.data("optkey")],i.data("opts",a)}),n=$("<ul/>"),i=function(e,t){var n,i,a,r=$("<p/>").data("optkey",e).data("type",t.type),c="",d="",l=!1;return t.description&&r.attr("title",o.i18n(t.description)),t.pattern&&r.data("pattern",t.pattern),r.append($("<span/>").text(o.i18n(e)+" : ")),"boolean"===t.type?((t["default"]||(l="allow_multiple_outputs"===e&&!s))&&(c=" checked",l&&(d=" disabled"),i=this.children("button:first"),n=i.data("opts")||{},n[e]=!0,i.data("opts",n)),r.append($('<input type="checkbox" value="true"'+c+d+"/>"))):t["enum"]?(a=$("<select/>").append($('<option value=""/>').text("Select...")),$.each(t["enum"],function(e,t){a.append($('<option value="'+t+'"/>').text(t))}),r.append(a)):r.append($('<input type="text" value=""/>')),r},a=function(e){var t=this,n=$('<span class="elfinder-button-icon elfinder-button-icon-preference"/>').on("click",function(){o.toggle()}),o=$('<div class="elfinder-edit-onlinconvert-options"/>').hide();e.options&&$.each(e.options,function(e,n){"download_password"!==e&&o.append(i.call(t,e,n))}),t.append(n,o)},p=function(t){var n,i,a;i="undefined"==typeof r.api?o.request({data:{cmd:"editor",name:"OnlineConvert",method:"init"},preventDefault:!0}):$.Deferred().resolve({api:r.api}),t=t.toLowerCase(),i.done(function(o){r.api=o.api,r.api&&(t?n="?category="+t:(n="",t="all"),r.conversions||(r.conversions={}),a=r.conversions[t]?$.Deferred().resolve(r.conversions[t]):$.getJSON("https://api2.online-convert.com/conversions"+n),a.done(function(n){r.conversions[t]=n,$.each(n,function(t,n){e[c.useTabs?"children":"find"](".onlineconvert-category-"+n.category).children(".onlineconvert-"+n.target).trigger("makeoption",n)})}))})},f=+new Date,m=0;return r.ext2mime||(r.ext2mime=o.arrayFlip(o.mimeTypes)),$.each(c.conv,function(i,c){var s=i.toLowerCase(),p="elfinder-edit-onlineconvert-"+s+f,u=$('<div id="'+p+'" class="onlineconvert-category onlineconvert-category-'+s+'"/>').data("cname",i);$.each(c,function(e,n){var c=e.toLowerCase(),d=l(i,e);r.ext2mime[d]||("audio"===s||"image"===s||"video"===s?r.ext2mime[d]=s+"/x-"+c:r.ext2mime[d]="application/octet-stream"),o.uploadMimeCheck(r.ext2mime[d],t.phash)&&u.append($('<div class="elfinder-edit-onlineconvert-button onlineconvert-'+c+'"/>').on("makeoption",function(e,t){var n=$(this);n.children(".elfinder-button-icon-preference").length||a.call(n,t)}).append($("<button/>").text(e).data("conv",e)))}),u.children().length&&(n.append($("<li/>").append($("<a/>").attr("href","#"+p).text(i))),e.append(u),d[s]=m++)}),c.useTabs?e.prepend(n).tabs({beforeActivate:function(e,t){p(t.newPanel.data("cname"))}}):$.each(c.conv,function(t){e.append($("<fieldset/>").append($("<legend/>").text(t)).append(e.children(".onlineconvert-category-"+t.toLowerCase()))),p(t)}),e}(),f=$(this).hide(),m=$("<div/>").append(p,$('<div class="elfinder-edit-onlineconvert-bottom-btn"/>').append($("<button/>").html(o.i18n("convertOn","Online-Convert.com")).on("click",function(){C()})),c.showLink?$(c.link):null).appendTo(f.parent().css({overflow:"auto"})),u=$('<div class="elfinder-edit-spiner elfinder-edit-online-convert"/>').hide().css({position:"absolute",top:"50%",textAlign:"center",width:"100%",fontSize:"16pt"}).html('<span class="elfinder-edit-loadingmsg">'+o.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(f.parent()),h=null,g=function(){return h?$.Deferred().resolve(h):(u.show(),o.url(t.hash,{async:!0,temporary:!0}).done(function(e){h=e}).fail(function(e){e&&o.error(e),a.elfinderdialog("destroy")}).always(function(){u.hide()}))},v=function(e){$(a).data("dfrd",g().done(function(n){m.fadeOut(),b({info:"Start conversion request."}),o.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[category]":e.category.toLowerCase(),"args[convert]":e.convert.toLowerCase(),"args[options]":JSON.stringify(e.options),"args[source]":o.convAbsUrl(n),"args[filename]":o.splitFileExtention(t.name)[0]+"."+l(e.category,e.convert)},preventDefault:!0}).done(function(t){x(t.apires,e.category,e.convert)}).fail(function(e){e&&o.error(e),
a.elfinderdialog("destroy")})}))},x=function(e,t,n){var i,a=[];e&&e.id?(i=e.status,"failed"===i.code?(u.hide(),e.errors&&e.errors.length&&$.each(e.errors,function(e,t){t.message&&a.push(t.message)}),o.error(a.length?a:i.info),m.fadeIn()):"completed"===i.code?y(e.output):(b(i),setTimeout(function(){w(e.id)},1e3))):(e.message&&o.toast({msg:o.i18n(e.message),mode:"error",timeOut:5e3,width:c.toastWidth}),o.toast({msg:o.i18n("editorConvNoApi"),mode:"warning",timeOut:3e3,width:c.toastWidth,onHidden:function(){C(t,n)}}))},b=function(e){u.show().children(".elfinder-edit-loadingmsg").text(e.info)},w=function(e){o.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[jobid]":e},preventDefault:!0}).done(function(e){x(e.apires)}).fail(function(e){e&&o.error(e),a.elfinderdialog("destroy")})},y=function(e){var n="";u.hide(),e&&e.length&&(a.elfinderdialog("destroy"),$.each(e,function(e,t){t.uri&&(n+=t.uri+"\n")}),o.upload({target:t.phash,files:[n],type:"text"}))},C=function(e,t){var n;e&&t?(n=c.conv[e]&&c.conv[e][t]&&c.conv[e][t].link?c.conv[e][t].link.replace("%s",t):"hash"===e?"/"+t+"-generator":"/convert-to-"+t,n=c.url.replace("%s",e).replace("%s",n)):n=c.url.replace("%s",O+"-conversion").replace("%s",""),u.hide(),m.hide(),f.parent().css({overflow:"hidden"}),$(a).data("dfrd",g().done(function(e){var t;e?(o.toast({msg:o.i18n("editorConvNeedUpload"),mode:"info",timeOut:5e3,width:c.toastWidth}),t={css:{height:"100%"}},a.editor.trigger("Prepare",{node:a,editorObj:void 0,instance:f,opts:t}),e=encodeURIComponent(o.convAbsUrl(e)),c["fix%20"]&&(e=e.replace(/%2520/g,"%252520")),e=n+e,f.attr("src",e).show().css(t.css)):(data.error&&o.error(data.error),a.elfinderdialog("destroy"))}))},O="document";(i=t.mime.match(/^(audio|image|video)/))&&(O=i[1]),c.useTabs&&d[O]&&p.tabs("option","active",d[O])},load:function(){},getContent:function(){},save:function(){},beforeclose:function(e){var t=$.Deferred(),n="about:blank";return e.src=n,setTimeout(function(){var o;try{o=e.contentWindow.location.href}catch(i){o=null}o===n?t.resolve():t.reject()},100),t},close:function(e){var t=(this.fm,$(e).data("dfrd"));t&&"pending"===t.state()&&t.reject()}}]},window.elFinder);